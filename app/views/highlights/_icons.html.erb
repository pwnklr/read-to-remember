<div class="icons" style='position: absolute; top: 86%; left:50%; transform:translateX(-50%);'>
  <p>
    <%= link_to unfav_highlight_path(h), id: "unfav",  method: :put, remote: true  do %>
      <i  title='Unfavorite' class="fas fa-heart flashcard-button" style='color:#555555'></i>
    <% end %>
  </p>
  <p>
    <%= link_to fav_highlight_path(h), id: "fav", method: :put, remote: true  do %>
      <i title='Favorite' class="far fa-heart flashcard-button" style='color:#aaa'></i>
    <% end %>
  </p>
  <p>
    <%= link_to edit_highlight_path(h), id: "edit", remote: true do %>
      <i class="fas fa-pen flashcard-button" title='Write/update note'></i>
    <% end %>
  </p>
  <p>
    <%= link_to export_highlight_path(h), id: "export", remote: true do %>
      <i onclick=showAlert() class="fas fa-paper-plane flashcard-button" title='Export'></i>
    <% end %>
  </p>
  <div class="delete">
    <p>
      <%= link_to h, method: :delete, data: {confirm: "Are you sure?"}, id: "del" do %>
        <i class="far fa-trash-alt flashcard-button" title='Delete'></i>
      <% end %>
    </p>
  </div>
</div>

<div id='myAlert' class="alert alert-warning alert-dismissible fade show m-1" style='display:none;'>
  Yay! Highlight was succsesfully exported!
  <button type="button" class="close" onclick=closeIt()>
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<script>

function initCarousel() {
  const myCarousel = document.getElementById('carouselExampleIndicators');
  const cards = document.getElementsByClassName("carousel-card");

  const ids = Array.prototype.map.call(cards, function(a) { return a.id.replace(/(false|true)-/, '') });
  console.log(ids)
  let myBool = Array.prototype.map.call(cards, function(a) { return JSON.parse(a.id.replace(/-[0-9]+/, '')) });
  console.log(myBool)

  const myNext = document.getElementById('myNext');
  const myPrev = document.getElementById('myPrev');

  const favLink = document.getElementById('fav');
  const unfavLink = document.getElementById('unfav');
  const editLink = document.getElementById('edit');
  const exportLink = document.getElementById('export');
  const delLink = document.getElementById('del');


  let i = 0;
  let j = ids.length - 1;

  window.location.href = 'http://localhost:3000/highlights/flashcards#' + ids[i]


  if (myBool[i]) {
    unfavLink.href = `${ids[i]}/unfav`;
    favLink.style.display = 'none';
    unfavLink.style.display = 'inherit';
  } else {
    favLink.href = `${ids[i]}/fav`;
    unfavLink.style.display = 'none';
    favLink.style.display = 'inherit';
  }


  editLink.href = `${ids[i]}/edit`;
  exportLink.href = `${ids[i]}/export`;
  delLink.href = `${ids[i]}/`;


  myNext.addEventListener('click', function () {

    if(i < j) {
      console.log(`${ids[i]}`);
      console.log(i);
      window.location.href = 'http://localhost:3000/highlights/flashcards#' + ids[i+1]


      if (myBool[i+1]) {
        unfavLink.href = `${ids[i+1]}/unfav`;
        favLink.style.display = 'none';
        unfavLink.style.display = 'inherit';
      } else {
        favLink.href = `${ids[i+1]}/fav`;
        unfavLink.style.display = 'none';
        favLink.style.display = 'inherit';
      }

        editLink.href = `${ids[i+1]}/edit`;
        exportLink.href = `${ids[i+1]}/export`;
        delLink.href = `${ids[i+1]}/`;

      i++;
    } else {
      console.log('the end, do counter on this!')
    }
  });

  myPrev.addEventListener('click', function () {
    if(i > 0) {
      console.log(`${ids[i]}`);
      window.location.href = 'http://localhost:3000/highlights/flashcards#' + ids[i-1]

      if (myBool[i-1]) {
        unfavLink.href = `${ids[i-1]}/unfav`;
        favLink.style.display = 'none';
        unfavLink.style.display = 'inherit';
      } else {
        favLink.href = `${ids[i-1]}/fav`;
        unfavLink.style.display = 'none';
        favLink.style.display = 'inherit';
      }

      editLink.href = `${ids[i-1]}/edit`;
      exportLink.href = `${ids[i+1]}/export`;
      delLink.href = `${ids[i-1]}/`;

      i--;
    }
  });

  favLink.addEventListener('click', changeHeart);
  unfavLink.addEventListener('click', changeHeart);

  function changeHeart() {

    if (myBool[i] === true) {
      myBool[i] = false;
      favLink.style.display = 'inherit';
      unfavLink.style.display = 'none';
    } else {
      myBool[i] = true;
      favLink.style.display = 'none';
      unfavLink.style.display = 'inherit';
    }
    console.log(myBool);
  }
}

//do the same with touch events ^^

function showAlert() {
  setTimeout(function(){
    document.getElementById('dwnld').click();
    document.getElementById('myAlert').style.display = 'inherit';
  }, 900 )
}

function closeIt() {
  document.getElementById('myAlert').style.display = 'none';
}


window.onload = initCarousel();

//export => works (filename: flashcard)
//edit => works (wrong card and for sources same) => solved
//delete => no remote everywhere!
//fav/unfav => kill me please = solved!
//+ big highlights... => exclude them from flashcards?
</script>
